<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>CellarCount 2026 ‚Äì Import</title>
<style>
body{font-family:Arial;margin:20px;background:#f6f6f6}
table{border-collapse:collapse;width:100%;background:#fff}
th,td{border:1px solid #ccc;padding:6px}
th{background:#eee}
input,button{padding:6px;margin:4px}
.total{margin-top:15px;font-weight:bold}
</style>
</head>
<body>

<h1>üç∑ CellarCount 2026</h1>
<p>ZIP 2 ‚Äì CSV-import med valg</p>

<input type="file" id="csv" accept=".csv">
<button onclick="importCSV()">Importer CSV</button>

<table>
<thead>
<tr>
<th>Navn</th><th>Type</th><th>Land</th><th>Region</th>
<th>Reol</th><th>Hylde</th><th>Antal</th><th>Pris</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<div class="total" id="total"></div>

<script>
let wines = JSON.parse(localStorage.getItem("cellarcount2026")||"[]");

function save(){localStorage.setItem("cellarcount2026",JSON.stringify(wines));}

function render(){
 const tb=document.getElementById("rows");
 tb.innerHTML="";
 let sum=0;
 wines.forEach(w=>{
  sum+=w.qty*w.price;
  tb.innerHTML+=`<tr>
   <td>${w.name}</td><td>${w.type}</td><td>${w.country}</td><td>${w.region}</td>
   <td>${w.reol}</td><td>${w.hylde}</td>
   <td>${w.qty}</td><td>${w.price.toFixed(2)}</td>
  </tr>`;
 });
 document.getElementById("total").innerText =
  "Samlet lagerv√¶rdi: "+sum.toLocaleString("da-DK",{minimumFractionDigits:2})+" kr.";
}

function importCSV(){
 const f=document.getElementById("csv").files[0];
 if(!f) return;

 let mode = prompt(
  "V√¶lg import-type:\n1 = Overskriv hele lageret\n2 = Tilf√∏j nye vine\n3 = Opdat√©r kun priser",
  "1"
 );
 if(!["1","2","3"].includes(mode)) return alert("Import annulleret");

 const r=new FileReader();
 r.onload=e=>{
  const lines=e.target.result.split(/\r?\n/).filter(l=>l.trim());
  const h=lines.shift().split(";");
  let added=0,updated=0;

  if(mode==="1") wines=[];

  lines.forEach(l=>{
   const c=l.split(";");
   const o={};
   h.forEach((k,i)=>o[k]=c[i]);

   o.qty=Number(o.qty||o.quantity||0);
   o.price=Number(o.price||0);
   o.vinId=o.vinId||crypto.randomUUID();

   const existing = wines.find(w=>w.vinId===o.vinId);

   if(!existing){
    if(mode!=="3"){
     wines.push(o);
     added++;
    }
   } else {
    if(mode==="3"){
     existing.price=o.price;
     updated++;
    }
   }
  });

  save();
  render();
  alert("Import f√¶rdig\nTilf√∏jet: "+added+"\nOpdateret: "+updated);
 };
 r.readAsText(f,"UTF-8");
}

render();
</script>
</body>
</html>
