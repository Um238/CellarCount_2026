<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>CellarCount 2026</title>
<style>
body{font-family:Arial;margin:20px}
button,input{padding:6px;margin:4px}
.label{border:1px solid #000;padding:8px;margin:6px;display:inline-block;width:260px}
</style>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body>

<h1>üç∑ CellarCount 2026</h1>

<input type="file" id="fileInput" accept=".csv,.xlsx">
<button onclick="startImport()">Import√©r</button>

<div id="labels"></div>

<script>
let wines = JSON.parse(localStorage.getItem("cellarcount2026")||"[]");

function startImport(){
 const file=document.getElementById("fileInput").files[0];
 if(!file) return alert("V√¶lg en fil");

 const choice = prompt(
  "V√¶lg import-type:\n"+
  "1 = Overskriv hele lageret\n"+
  "2 = Tilf√∏j nye vine\n"+
  "3 = Opdat√©r kun priser",
  "1"
 );

 if(!choice) return;

 const reader = new FileReader();
 reader.onload = e => {
  let data = new Uint8Array(e.target.result);
  let wb = XLSX.read(data,{type:'array'});
  let rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);

  if(choice==="1") wines=[];

  rows.forEach(r=>{
   if(!r.vinId) return;
   let ex = wines.find(w=>w.vinId===r.vinId);
   if(ex){
    if(choice==="3") ex.price = Number(r.price);
   } else if(choice==="1"||choice==="2"){
    wines.push({
     vinId:r.vinId,
     name:r.name,
     type:r.type,
     country:r.country,
     region:r.region,
     reol:r.reol,
     hylde:r.hylde,
     qty:Number(r.qty),
     price:Number(r.price)
    });
   }
  });

  localStorage.setItem("cellarcount2026",JSON.stringify(wines));
  alert("Import gennemf√∏rt. Vine i alt: "+wines.length);
  render();
 };
 reader.readAsArrayBuffer(file);
}

function render(){
 const d=document.getElementById("labels");
 d.innerHTML="";
 wines.forEach(w=>{
  const box=document.createElement("div");
  box.className="label";
  box.innerHTML=`<strong>${w.name}</strong><br>
  ${w.type} ‚Äì ${w.country}<br>
  Reol ${w.reol} ¬∑ Hylde ${w.hylde}<br>`;
  const c=document.createElement("canvas");
  QRCode.toCanvas(c,w.vinId);
  box.appendChild(c);
  d.appendChild(box);
 });
}
render();
</script>

</body>
</html>
